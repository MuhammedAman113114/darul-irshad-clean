Thanks for explaining in detail ‚Äî your system architecture is well-structured and clearly built for flexibility and real-world academic workflows. Here's how to fully and optimally integrate the Subject & Timetable system with the rest of your modules (Take Attendance, History, Missed, and Attendance Sheet), ensuring class-specific configurations are respected:

‚úÖ 1. Fix: Class-Specific Timetable Configuration
Problem:
Your current period configuration (timetablePeriodConfig) is applying globally (same across all classes).

üîß Solution:
Make timetablePeriodConfig class-specific by including all keys:

ts
Copy
Edit
timetablePeriodConfig: {
  courseType: "pu",      // e.g., "pu" or "postpu"
  year: "1",             // e.g., "1", "3"
  stream: "commerce",    // e.g., "commerce", "arts", "islamic"
  section: "A",          // e.g., "A", "B"
  periodsPerDay: {
    monday: 4,
    tuesday: 3,
    ...
  },
  defaultPeriods: 3
}
DB & API Change:
Add stream and section to the period config schema.

Modify /api/period-config to filter by full class identity:

ts
Copy
Edit
GET /api/period-config?courseType=pu&year=1&stream=commerce¬ßion=A
‚úÖ 2. Update Timetable Save Logic
Problem:
When saving from "Configure" button, it's overriding timetable globally.

Fix:
Update the save API (e.g. POST /api/timetable) to include all class-specific keys:

ts
Copy
Edit
POST /api/timetable
{
  courseType: "pu",
  year: "1",
  stream: "commerce",
  section: "A",
  timetable: [
    { dayOfWeek: "monday", periodNumber: 1, subjectId: 30, startTime: "09:00", endTime: "10:00" },
    ...
  ]
}
Backend Logic: Ensure you're clearing only the specific class‚Äôs timetable before inserting the new data:

sql
Copy
Edit
DELETE FROM timetable 
WHERE courseType = ? AND year = ? AND stream = ? AND section = ?
‚úÖ 3. Integrate Subject & Timetable into Attendance Modules
A. Take Attendance
On class selection, fetch:

ts
Copy
Edit
GET /api/timetable?courseType=pu&year=1&stream=commerce¬ßion=A
Extract subjectName and subjectCode from the joined response.

Display periods as:

vbnet
Copy
Edit
aqeeda (AQD) - 09:00 to 10:00
tajweed (TJW) - 10:00 to 11:00
When saving attendance, store periodNumber, not the subject name.

On the backend, resolve subjectId by joining with the timetable for that class/date.

B. History
When fetching attendance:

ts
Copy
Edit
GET /api/attendance?courseType=pu&year=1&stream=commerce¬ßion=A&date=2025-07-11
Join with timetable and subjects to display:

yaml
Copy
Edit
Period 1: aqeeda (AQD) - Present: 15, Absent: 2
C. Attendance Sheet
When building daily grid:

Use timetable to determine how many periods exist on each date.

Skip Fridays (from timetable or config).

Show H (holiday) if no periods exist.

D. Missed
To find gaps, do a LEFT JOIN:

sql
Copy
Edit
SELECT t.*
FROM timetable t
LEFT JOIN attendance a ON 
  a.period = t.periodNumber AND
  a.date = '2025-07-11' AND
  a.courseType = t.courseType AND 
  a.year = t.year AND 
  a.stream = t.stream AND 
  a.section = t.section
WHERE a.id IS NULL
This ensures only periods that should exist but have no attendance will show up as missing.

‚úÖ 4. UI Enhancements (Optional)
In Subject & Timetable tab:

Add a class selector at top (courseType + year + stream + section).

Show current period config (3 on Mon, 4 on Tue etc).

Allow per-day ‚ÄúAdd Period‚Äù / ‚ÄúRemove Period‚Äù from frontend.

Store using new class-specific timetablePeriodConfig.

‚úÖ 5. Replit Prompt (Summarized Development Task)
Here‚Äôs how you‚Äôd describe this task in Replit/Dev ticket format:

Task: Fix timetable misconfiguration ‚Äî Class-specific period structure

Bug: Timetable period changes are affecting all classes globally.

Fix:

Make timetablePeriodConfig class-specific (add stream, section).

In /api/period-config, filter by courseType, year, stream, section.

In Configure save, delete only for the selected class.

When saving attendance, only link to periodNumber and resolve subject from timetable dynamically.

Impact: Each class will now have a unique timetable and the attendance system will reflect the exact subject and period as per the configured timetable.