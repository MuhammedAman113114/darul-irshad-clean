// âœ… TASK: Full student data sync from DB across modules (attendance, leave, holidays, namaz, etc)

// STEP 1: Create a central API to fetch all student data from PostgreSQL
app.get('/api/students', async (req, res) => {
  try {
    const students = await db.any('SELECT * FROM students');
    res.json(students);
  } catch (err) {
    res.status(500).json({ error: 'Failed to fetch students from DB' });
  }
});

// STEP 2: On page load (React or HTML/JS), fetch students and sync to UI
async function fetchStudentsAndSyncToUI() {
  const response = await fetch('/api/students');
  const students = await response.json();

  // Filter, group, or store students locally for other modules
  localStorage.setItem('students', JSON.stringify(students));

  // âœ… Optionally render student names in dropdowns/lists
  renderStudentDropdown(students);
}

// STEP 3: Whenever a student is added, also POST to DB
async function addStudent(studentObj) {
  await fetch('/api/students', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(studentObj),
  });

  // Refresh localStorage + UI
  await fetchStudentsAndSyncToUI();
}

// STEP 4: Use students across modules like:
const students = JSON.parse(localStorage.getItem('students') || '[]');

// Filter for attendance
const puStudents = students.filter(s => s.course_type === 'pu');

// Use for Namaz
const postPuStudents = students.filter(s => s.course_type === 'post-pu');

// Use for Remarks / Leave log / Attendance Sheet
displayRemarksFor(students);
displayLeaveHistory(students);

// Optional Sync Logic (background)
setInterval(() => fetchStudentsAndSyncToUI(), 60000); // every 1 min
âš™ï¸ Backend Table Reference from DB UI
You are syncing with:

students â Main student info source

attendance â Class attendance

namaz_attendance â Namaz log (Fajr, Zuhr etc.)

leaves â Leave records

remarks â Teacher feedback

holidays â Common holidays

ğŸ’¡ Tip for Data Integrity
Always fetch fresh student list from /api/students before loading any attendance/namaz/leave form.

Store locally using localStorage or indexedDB for offline support.

Keep ID consistency (roll_no, id, name) across tables for linking.