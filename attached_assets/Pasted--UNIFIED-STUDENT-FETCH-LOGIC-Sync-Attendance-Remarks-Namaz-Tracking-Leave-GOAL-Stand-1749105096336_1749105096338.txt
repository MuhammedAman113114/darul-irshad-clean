ğŸ› ï¸ UNIFIED STUDENT FETCH LOGIC: Sync Attendance â†’ Remarks, Namaz Tracking, Leave

ğŸ¯ GOAL:
Standardize how Remarks, Namaz, and Leave modules fetch students using the same logic used by Attendance â†’ based on sectionKey and localStorage.

âœ… STEP-BY-STEP FIX:

ğŸ” 1. UNIVERSAL STUDENT FETCH FUNCTION

```js
function getSectionKey(courseType, year, courseDivision, section) {
  if (courseType === "post-pu") {
    return `${courseType}_${year}_A`;
  }
  return `${courseType}_${year}_${courseDivision}_${section}`;
}

function isStudentOnLeave(studentId, date) {
  const leaves = JSON.parse(localStorage.getItem("leaveData") || "[]");
  return leaves.some(leave =>
    leave.studentId === studentId &&
    new Date(leave.fromDate) <= new Date(date) &&
    new Date(leave.toDate) >= new Date(date)
  );
}

function fetchStudents(courseType, year, courseDivision, section, date) {
  const sectionKey = getSectionKey(courseType, year, courseDivision, section);
  const sectionData = localStorage.getItem(sectionKey);
  const sectionStudents = sectionData ? JSON.parse(sectionData) : [];

  return sectionStudents.map(student => ({
    id: student.id,
    name: student.name,
    rollNo: student.rollNo,
    status: isStudentOnLeave(student.id, date) ? "on-leave" : "present",
    onLeave: isStudentOnLeave(student.id, date)
  }));
}
ğŸ“ 2. USE THIS IN:

ğŸŸ© Remarks Module

ğŸŸ© Namaz Tracking

ğŸŸ© Leave Management

Replace old student loading logic with:

js
Copy
Edit
const students = fetchStudents(courseType, year, courseDivision, section, selectedDate);
ğŸ§ª 3. VALIDATE WITH TEST DATA

Check for pu_1_commerce_A â†’ Should load 4 students

Check for post-pu_3_A â†’ Should load 1 student

Confirm on-leave students show green tag/status

ğŸ“Œ 4. FALLBACK DISPLAY

js
Copy
Edit
if (students.length === 0) {
  return <p>No students found in the selected section.</p>;
}
ğŸ”„ 5. SYNC DIAGRAM

sql
Copy
Edit
ğŸ“² User Selects Course/Year/Section
  â†“
ğŸ§  Build sectionKey (PU vs Post-PU logic)
  â†“
ğŸ“¦ Fetch localStorage[sectionKey]
  â†“
âœ… Format with onLeave check
  â†“
ğŸ–¥ï¸ Display in Namaz / Leave / Remarks Module